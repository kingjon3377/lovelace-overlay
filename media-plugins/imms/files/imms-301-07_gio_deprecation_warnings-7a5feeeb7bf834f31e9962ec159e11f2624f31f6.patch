From 7a5feeeb7bf834f31e9962ec159e11f2624f31f6 Mon Sep 17 00:00:00 2001
From: John Lindgren <john.lindgren@aol.com>
Date: Sat, 4 Jul 2015 11:36:03 -0400
Subject: [PATCH] Fix GIO deprecation warnings.

---
 imms/immscore/giosocket.h  | 10 +++++-----
 imms/immsd/socketserver.cc |  2 +-
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/imms/immscore/giosocket.h b/imms/immscore/giosocket.h
index 9397f63..f16a45b 100644
--- a/imms/immscore/giosocket.h
+++ b/imms/immscore/giosocket.h
@@ -71,7 +71,7 @@ class GIOSocket : public LineProcessor
     {
         if (con)
         {
-            g_io_channel_close(con);
+            g_io_channel_shutdown(con, true, 0);
             g_io_channel_unref(con);
         }
         if (write_tag)
@@ -116,8 +116,8 @@ class GIOSocket : public LineProcessor
 
         unsigned len = strlen(outp);
         gsize n = 0;
-        GIOError e = g_io_channel_write(con, (char*)outp, len, &n);
-        if (e == G_IO_ERROR_NONE)
+        GIOStatus s = g_io_channel_write_chars(con, (char*)outp, len, &n, 0);
+        if (s == G_IO_STATUS_NORMAL)
         {
             if (n == len)
             {
@@ -149,8 +149,8 @@ class GIOSocket : public LineProcessor
         if (condition & G_IO_IN)
         {
             gsize n = 0;
-            GIOError e = g_io_channel_read(con, buf, sizeof(buf) - 1, &n);
-            if (e == G_IO_ERROR_NONE)
+            GIOStatus s = g_io_channel_read_chars(con, buf, sizeof(buf) - 1, &n, 0);
+            if (s == G_IO_STATUS_NORMAL)
             {
                 buf[n] = '\0';
                 char *lineend, *cur = buf;
diff --git a/imms/immsd/socketserver.cc b/imms/immsd/socketserver.cc
index ba1d1b9..e8ab26d 100644
--- a/imms/immsd/socketserver.cc
+++ b/imms/immsd/socketserver.cc
@@ -64,7 +64,7 @@ SocketListenerBase::~SocketListenerBase()
 {
     if (listener)
     {
-        g_io_channel_close(listener);
+        g_io_channel_shutdown(listener, true, 0);
         g_io_channel_unref(listener);
         listener = 0;
     }
